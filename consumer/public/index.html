<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>jQuery easyXDM plugin test page for cross domain AJAX</title>
    <meta http=" " content="content" />
    <style type="text/css" media="screen">
      .success {
        background-color: #bbffbb;
        color: green;
        border: thin solid green;
      }
      .failed {
        background-color: #ffbbbb;
        color: red;
        border: thin solid red;
      }
    </style>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.js"></script>
    <script type="text/javascript" src="http://provider.example.net:4569/javascripts/jquery.easyXDM.js"></script>
    <script type="text/javascript">
      $(function(){
        function doTheAjax(id,str,verb,relative_url) {
          var result_id = id + "_result";
          $("body table").append("<tr><td>" + str + "</td><td id=\""+result_id+"\"></td></tr>");
          $.ajax({
            url: "http://provider.example.net:4569"+relative_url,
            crossDomain: true,
            type: verb,
            dataType: "json",
            data: {foo : "bar"},
            success: function(json) {
              console.log("success callback for "+result_id);
              if (json.foo === "bar") {
                $("#"+result_id).addClass("success").html("success");
              } 
              else {
                console.log("JSON problem");
                console.log(json);
                $("#"+result_id).addClass("failed").html("failed");
              }
            },
            error: function(jqXHR, textStatus, errorThrown) {
              console.log("error callback for "+result_id);
              console.log(textStatus);
              console.log(errorThrown);
              $("#"+result_id).addClass("failed").html(errorThrown.toString());
            }
          });
        }
        $("#jquery_version").html(jQuery.fn.jquery);
        // Keep existing value of $.support.cors to check that auto selection of transport works as expected.
        doTheAjax("test1","CORS GET","GET","/test_get.js");
        doTheAjax("test2","CORS POST","POST","/test_post.js");
        $.support.cors = true; // Force usage of regular ajax, even if CORS is not supported.
        doTheAjax("test3","jquery GET, fail on IE <= 9","GET","/test_get.js");
        doTheAjax("test4","jquery POST, fail on IE <= 9","POST","/test_post.js");
        $.support.cors = false; // Force usage of plugin, even if CORS is supported..
        doTheAjax("test5","easyxdm GET","GET","/test_get.js");
        doTheAjax("test6","easyxdm POST","POST","/test_post.js");
        doTheAjax("test7","easyxdm GET invalid url, always fail with 'Not Found'","GET","/test_missing.js");
      });
    </script>
  </head>
  <body>
    <h1>Testing jQuery-EasyXDM with jQuery <span id="jquery_version"></span></h1>
    <table>
    </table>
  </body>
</html>
